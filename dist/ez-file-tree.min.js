!function(angular){"use strict";angular.module("ez.fileTree",["ez.object2array"]).constant("EzFileTreeConfig",{enableChecking:!1,multiSelect:!1,onlyFileSelection:!1,icons:{chevronRight:"fa fa-chevron-right",chevronDown:"fa fa-chevron-down",folder:"fa fa-folder",file:"fa fa-file"},childrenField:"children",isFolder:function(data){return"folder"===data.type||"album"===data.type}}).controller("RecursionCtrl",["$scope",function($scope){$scope.select=function(data,fromCheck){$scope.masterSelect(data,fromCheck,$scope)}}]).directive("ezFileTree",["$compile","$timeout","EzFileTreeConfig",function($compile,$timeout,EzFileTreeConfig){return{restrict:"EA",scope:{tree:"=ezFileTree",getChildren:"="},templateUrl:"ez-file-tree-container.html",link:function(scope,element,attrs){{var multiSelect="true"===attrs.multiSelect?!0:EzFileTreeConfig.multiSelect;"true"===attrs.onlyFileSelection?!0:EzFileTreeConfig.onlyFileSelection}scope.childrenField=attrs.childrenField||EzFileTreeConfig.childrenField,scope.enableChecking="true"===attrs.enableChecking?!0:EzFileTreeConfig.enableChecking,scope.isFolder=attrs.isFolder?scope.$eval(attrs.isFolder):EzFileTreeConfig.isFolder,scope.icons=EzFileTreeConfig.icons,scope.disableSelect=!1,scope.tree._selectedFiles={},scope.tree._activeFiles={},scope.toggle=function(e,data){if(scope.disableSelect=!0,$timeout(function(){scope.disableSelect=!1},500),data._open=!data._open,!data.children||data.children&&!data.children.length){if(!scope.getChildren)throw new Error("You must add a getChildren attribute");scope.getChildren(data)}};var activate=function(_scope){_scope.data._active=!0,scope.tree._activeFiles[_scope.data.id]=_scope.data,"undefined"!=typeof _scope.$parent.$parent.data&&activate(_scope.$parent.$parent)},deactivate=function(_scope,data){var active=!1;delete scope.tree._activeFiles[_scope.data.id],angular.forEach(_scope.data[scope.childrenField],function(v){return v._selected===!0&&data!==v?(active=!0,void(scope.tree._activeFiles[_scope.data.id]=_scope.data)):void 0}),_scope.data._active=active,active===!1&&"undefined"!=typeof _scope.$parent.$parent.data&&deactivate(_scope.$parent.$parent,data)},unselectAll=function(files){angular.forEach(files,function(v){v[scope.childrenField]&&v[scope.childrenField].length&&unselectAll(v[scope.childrenField]),v._selected=!1})},select=function(item){multiSelect?scope.tree._selectedFiles[item.id]=item:(scope.tree._selectedFile=item,unselectAll(scope.tree[scope.childrenField])),item._selected=!0,scope.$emit("ez-file-tree.select",item)},unselect=function(item){item._selected=!1,scope.$emit("ez-file-tree.unselect",item),multiSelect?delete scope.tree._selectedFiles[item.id]:scope.tree._selectedFile=null};scope.masterSelect=function(item,fromCheck,$scope){var delay=fromCheck||!scope.checkingEnabled?0:200;$timeout(function(){scope.disableSelect!==!0&&(scope.disableSelect=!1,item._selected?fromCheck?(select(item),activate($scope.$parent.$parent)):(unselect(item),deactivate($scope.$parent.$parent,item)):fromCheck?(unselect(item),deactivate($scope.$parent.$parent,item)):(select(item),activate($scope.$parent.$parent)))},delay)}}}}])}(angular);